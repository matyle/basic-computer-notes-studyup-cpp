# Bomb Lab

## ä»‹ç»

â€œäºŒè¿›åˆ¶ç‚¸å¼¹â€æ˜¯ä½œä¸ºç›®æ ‡ä»£ç æ–‡ä»¶æä¾›ç»™å­¦ç”Ÿçš„ç¨‹åºã€‚ è¿è¡Œæ—¶ï¼Œå®ƒæç¤ºç”¨æˆ·è¾“å…¥6ä¸ªä¸åŒçš„å­—ç¬¦ä¸²ã€‚ å¦‚æœå…¶ä¸­ä»»ä½•ä¸€ä¸ªä¸æ­£ç¡®ï¼Œç‚¸å¼¹å°±ä¼šâ€œçˆ†ç‚¸â€ï¼Œå­¦ç”Ÿå¿…é¡»é€šè¿‡æ‹†å¸å’Œé€†å‘å·¥ç¨‹ç¨‹åºæ¥â€œæ¶ˆæ•£â€è‡ªå·±ç‹¬ç‰¹çš„ç‚¸å¼¹ï¼Œä»¥ç¡®å®š6ä¸ªå­—ç¬¦ä¸²åº”è¯¥æ˜¯ä»€ä¹ˆã€‚è¯¥å®éªŒå®¤æ•™ä¼šå­¦ç”Ÿç†è§£æ±‡ç¼–è¯­è¨€ï¼Œå¹¶å¼ºè¿«ä»–ä»¬å­¦ä¹ å¦‚ä½•ä½¿ç”¨è°ƒè¯•å™¨ã€‚

[å®éªŒåœ°å€](http://csapp.cs.cmu.edu/3e/labs.html)

[READMEæ–‡æ¡£](http://csapp.cs.cmu.edu/3e/README-bomblab)

[å®éªŒæŒ‡å¯¼](http://csapp.cs.cmu.edu/3e/bomblab.pdf)

## å®éªŒæ­¥éª¤

ä½¿ç”¨GDBé€†å‘å·¥ç¨‹æ¨æ–­6ä¸ªå­—ç¬¦ä¸²ã€‚è®¾ç½®æ–­ç‚¹ï¼Œä¸€æ­¥ä¸€æ­¥è°ƒè¯•ï¼Œæ‰¾åˆ°`explode_bomb`çš„è·³è½¬å‘½ä»¤ï¼Œç»“åˆé€»è¾‘å’Œå¯„å­˜å™¨çš„å€¼è¿›è¡Œåˆ¤æ–­å­—ç¬¦ä¸²çš„å€¼ã€‚



<p align="center">
<img src="https://s3.ax1x.com/2020/12/29/rqFoFg.png" width="400">
</p>



æ¯ä¸€ä¸ªç‚¸å¼¹éƒ½æ˜¯ä»`read_line()`å‡½æ•°ä»è¾“å…¥æµstdinä¸­è¯»å–çš„ï¼Œå­˜æ”¾äºinputå˜é‡ä¸­ï¼Œå¯¹åº”`%rax`å¯„å­˜å™¨ä¸­ï¼Œå°†`%rax`çš„å€¼èµ‹ç»™`%rdi`ä½œä¸ºå‚æ•°ä¼ é€’ç»™`phase_x`å‡½æ•°ï¼Œ**`%rdi`ä¸­å­˜æ”¾çš„æ˜¯å­—ç¬¦ä¸²çš„é¦–åœ°å€**ã€‚

[gdbå¸®åŠ©æ–‡æ¡£](http://csapp.cs.cmu.edu/3e/docs/gdbnotes-x86-64.pdf)

## phase_1

åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š
```bash
è°ƒè¯•bombå¯æ‰§è¡Œç¨‹åº
unix> gdb bomb 

åæ±‡ç¼–phase_1å‡½æ•°
gdb> disas phase_1
```
å¾—åˆ°ï¼š
```bash
gdb) disas phase_1
Dump of assembler code for function phase_1:
   0x0000000000400ee0 <+0>:	sub    $0x8,%rsp
   0x0000000000400ee4 <+4>:	mov    $0x402400,%esi
   0x0000000000400ee9 <+9>:	callq  0x401338 <strings_not_equal>
   0x0000000000400eee <+14>:	test   %eax,%eax
   0x0000000000400ef0 <+16>:	je     0x400ef7 <phase_1+23>
   0x0000000000400ef2 <+18>:	callq  0x40143a <explode_bomb>
   0x0000000000400ef7 <+23>:	add    $0x8,%rsp
   0x0000000000400efb <+27>:	retq
End of assembler dump.
```

1. å­—ç¬¦ä¸²é¦–åœ°å€åœ¨`%rdi`å¯„å­˜å™¨ä¸­ã€‚
2. ç”³è¯·8ä¸ªå­—èŠ‚çš„æ ˆç©ºé—´ã€‚
3. å°†ç«‹å³æ•°`0x402400`å­˜æ”¾åˆ°`%esi`å¯„å­˜å™¨ä¸­ï¼ˆç¬¬äºŒä¸ªå‚æ•°å¯„å­˜å™¨ï¼‰ã€‚
4. è°ƒç”¨å­—ç¬¦ä¸²æ¯”è¾ƒå‡½æ•°ï¼Œæ¯”è¾ƒæ˜¯å¦ç›¸åŒï¼Œç»“æœè¿”å›äº`%eax`ä¸­ã€‚
5. æ£€æŸ¥`%eax`ä¸­çš„å€¼æ˜¯å¦ä¸º0ï¼Œä¸º0è·³è½¬åˆ°<phase_1+23>ï¼Œè·³è¿‡å¼•çˆ†ç‚¸å¼¹çš„å‡½æ•°ã€‚
6. å¦åˆ™æ‰§è¡Œexplod_bombå‡½æ•°ï¼Œå›æ”¶æ ˆç©ºé—´ã€‚

æ•…`%esi`å¯„å­˜å™¨å­˜æ”¾çš„æŒ‡å‘å­—ç¬¦ä¸²çš„åœ°å€ä¾¿æ˜¯ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚

åœ¨phase_1å’Œexplode_bombå¤„è®¾ç½®æ–­ç‚¹å¹¶è¿è¡Œï¼Œæ£€æŸ¥`%rsi`å¯„å­˜å™¨æŒ‡å‘å­—ç¬¦ä¸²çš„å€¼ã€‚

<p align="center">
<img src="https://s3.ax1x.com/2020/12/29/rqFMLV.png" width="400">
</p>

ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²ä¾¿æ˜¯`Border relations with Canada have never been better.`ã€‚

ç¬¬ä¸€ä¸ªğŸ’£è§£é™¤ã€‚

## phase_2

åŒæ ·çš„æ­¥éª¤æŸ¥çœ‹`phase_2`å‡½æ•°çš„åæ±‡ç¼–ä»£ç ï¼š
```bash
(gdb) disas phase_2
Dump of assembler code for function phase_2:
   0x0000000000400efc <+0>:	push   %rbp
   0x0000000000400efd <+1>:	push   %rbx
   0x0000000000400efe <+2>:	sub    $0x28,%rsp
   0x0000000000400f02 <+6>:	mov    %rsp,%rsi
   0x0000000000400f05 <+9>:	callq  0x40145c <read_six_numbers>
   0x0000000000400f0a <+14>:	cmpl   $0x1,(%rsp)
   0x0000000000400f0e <+18>:	je     0x400f30 <phase_2+52>
   0x0000000000400f10 <+20>:	callq  0x40143a <explode_bomb>
   0x0000000000400f15 <+25>:	jmp    0x400f30 <phase_2+52>
   0x0000000000400f17 <+27>:	mov    -0x4(%rbx),%eax
   0x0000000000400f1a <+30>:	add    %eax,%eax
   0x0000000000400f1c <+32>:	cmp    %eax,(%rbx)
   0x0000000000400f1e <+34>:	je     0x400f25 <phase_2+41>
   0x0000000000400f20 <+36>:	callq  0x40143a <explode_bomb>
   0x0000000000400f25 <+41>:	add    $0x4,%rbx
   0x0000000000400f29 <+45>:	cmp    %rbp,%rbx
   0x0000000000400f2c <+48>:	jne    0x400f17 <phase_2+27>
   0x0000000000400f2e <+50>:	jmp    0x400f3c <phase_2+64>
   0x0000000000400f30 <+52>:	lea    0x4(%rsp),%rbx
   0x0000000000400f35 <+57>:	lea    0x18(%rsp),%rbp
   0x0000000000400f3a <+62>:	jmp    0x400f17 <phase_2+27>
   0x0000000000400f3c <+64>:	add    $0x28,%rsp
   0x0000000000400f40 <+68>:	pop    %rbx
   0x0000000000400f41 <+69>:	pop    %rbp
   0x0000000000400f42 <+70>:	retq
End of assembler dump.
```
æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å°†`%rbp`å’Œ`%rbx`å‹å…¥æ ˆåï¼Œè¯·æ±‚äº†0x28å¤§å°çš„æ ˆç©ºé—´ï¼Œå°†`%rsp`èµ‹ç»™`%rsi`ç¬¬äºŒä¸ªå¯„å­˜å™¨ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å¯„å­˜å™¨æ˜¯`%rdi`ï¼Œç„¶åè¿›å»äº†`read_six_numbers`å‡½æ•°ï¼Œæ ¹æ®åå­—æ˜¯ä¼°è®¡è¯»å…¥6ä¸ªæ•°å­—çš„å‡½æ•°ã€‚

æˆ‘ä»¬è¿›å…¥`read_six_numbers`å‡½æ•°ä¸€æ¢ç©¶ç«Ÿã€‚

```bash
(gdb) disas read_six_numbers
Dump of assembler code for function read_six_numbers:
   0x000000000040145c <+0>:	sub    $0x18,%rsp
   0x0000000000401460 <+4>:	mov    %rsi,%rdx
   0x0000000000401463 <+7>:	lea    0x4(%rsi),%rcx
   0x0000000000401467 <+11>:	lea    0x14(%rsi),%rax
   0x000000000040146b <+15>:	mov    %rax,0x8(%rsp)
   0x0000000000401470 <+20>:	lea    0x10(%rsi),%rax
   0x0000000000401474 <+24>:	mov    %rax,(%rsp)
   0x0000000000401478 <+28>:	lea    0xc(%rsi),%r9
   0x000000000040147c <+32>:	lea    0x8(%rsi),%r8
   0x0000000000401480 <+36>:	mov    $0x4025c3,%esi
   0x0000000000401485 <+41>:	mov    $0x0,%eax
   0x000000000040148a <+46>:	callq  0x400bf0 <__isoc99_sscanf@plt>
   0x000000000040148f <+51>:	cmp    $0x5,%eax
   0x0000000000401492 <+54>:	jg     0x401499 <read_six_numbers+61>
   0x0000000000401494 <+56>:	callq  0x40143a <explode_bomb>
   0x0000000000401499 <+61>:	add    $0x18,%rsp
   0x000000000040149d <+65>:	retq
End of assembler dump.
```
é€æŒ‡ä»¤åˆ†æï¼š
1. ç”³è¯·0x18å¤§å°çš„æ ˆç©ºé—´ï¼Œ24ä¸ªå­—èŠ‚ã€‚
2. å°†`%rsi`èµ‹ç»™`%rdx`å¯„å­˜å™¨ï¼Œ`%rsi`æ˜¯`phase_2`ä¼ å…¥è¿›æ¥çš„å‚æ•°ï¼Œå†…å®¹æ˜¯è°ƒç”¨å‡½æ•°ä¹‹å‰çš„`%rsp`ã€‚
3. å°†`%rsi`åŠ ä¸Š0x4èµ‹ç»™`rcx`å¯„å­˜å™¨ã€‚
4. å°†`%rsi`åŠ ä¸Š0x14èµ‹ç»™`rax`å¯„å­˜å™¨ã€‚
5. å°†`%rax`èµ‹ç»™`%rsp`+0x8åç§»é‡æŒ‡å‘çš„å†…å­˜ä¸­ã€‚
6. å°†`%rsi`åŠ ä¸Š0x10èµ‹ç»™`rax`å¯„å­˜å™¨ã€‚
7. å°†`%rax`èµ‹ç»™`%rsp`æŒ‡å‘çš„å†…å­˜ä¸­ã€‚
8. å°†`%rsi`åŠ ä¸Š0xcèµ‹ç»™`%r9`å¯„å­˜å™¨ã€‚
9. å°†`%rsi`åŠ ä¸Š0x8èµ‹ç»™`%r8`å¯„å­˜å™¨ã€‚
10. å°†ç«‹å³æ•°0x4025c3èµ‹ç»™`%esi`å¯„å­˜å™¨ã€‚
11. å°†`eax`ç½®ä¸º0ã€‚
12. è°ƒç”¨`sscanf`å‡½æ•°ã€‚

`sscanf`å‡½æ•°çš„è¯­æ³•æ˜¯ï¼š
```c
int sscanf(const char *buffer, const char *format, [argument]...); 
```
ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯èµ·å§‹åœ°å€ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æ ¼å¼å­—ç¬¦ä¸²ï¼Œç¬¬ä¸‰ä¸ªæ˜¯å‚æ•°å˜é‡ã€‚
æˆ‘ä»¬è§‚å¯Ÿä¸€ä¸‹æ­¤æ—¶å„ä¸ªå¯„å­˜å™¨çš„å†…å®¹ã€‚
| %rax | %rdi | %rsi | %rdx | %rcx | %r8 | %r9 | 
| ---  | ---  | ---  | ---  | ---  | --- | --- | 
|  0x0 | ç¬¬äºŒä¸ªå­—ç¬¦ä¸²åœ°å€ | 0x4025c3 | è°ƒç”¨å‡½æ•°ä¹‹å‰çš„%rsp | è°ƒç”¨å‡½æ•°ä¹‹å‰çš„%rsp + 0x4 | è°ƒç”¨å‡½æ•°ä¹‹å‰çš„%rsp + 0x8 | è°ƒç”¨å‡½æ•°ä¹‹å‰çš„%rsp + 0xc | è°ƒç”¨å‡½æ•°ä¹‹å‰çš„%rsp + 0x1c | 
| è¿”å›å€¼ | ç¬¬ä¸€ä¸ªå‚æ•°å¯„å­˜å™¨ | ç¬¬äºŒä¸ªå‚æ•°å¯„å­˜å™¨ | ç¬¬ä¸‰ä¸ªå‚æ•°å¯„å­˜å™¨ | ç¬¬å››ä¸ªå‚æ•°å¯„å­˜å™¨ | ç¬¬äº”ä¸ªå‚æ•°å¯„å­˜å™¨ | ç¬¬å…­ä¸ªå‚æ•°å¯„å­˜å™¨ | 

å¯ä»¥æƒ³åˆ°`%rdi`å¯¹åº”ç¬¬ä¸€ä¸ªå‚æ•°èµ·å§‹åœ°å€;

`%rsi`å¯¹åº”ç¬¬äºŒä¸ªå‚æ•°å¯¹åº”æ ¼å¼å­—ç¬¦ä¸²;

`%rdx`å¯¹åº”`&buffer[0]`;

`%rcx`å¯¹åº”`&buffer[1]`;

`r8`å¯¹åº”`&buffer[2]`;

`r9`å¯¹åº”`&buffer[3]`;

`è°ƒç”¨å‡½æ•°å‰çš„%rsp + 0x10`ï¼Œä¹Ÿå°±æ˜¯`å‡½æ•°å†…çš„%rsp`å¯¹åº”`&buffer[4]`;

`è°ƒç”¨å‡½æ•°å‰çš„%rsp + 0x14`ï¼Œä¹Ÿå°±æ˜¯`å‡½æ•°å†…çš„%rsp+0x8`å¯¹åº”`&buffer[5]`ã€‚

æˆ‘ä»¬å°†è¿›å…¥`read_six_number`å‡½æ•°å†…æ‰§è¡Œåˆ°è°ƒç”¨`sscanf`å‡½æ•°ä¹‹å‰ï¼ŒæŸ¥çœ‹`%rsi`çš„å†…å®¹
```bash
(gdb) x/s $esi
0x4025c3:	"%d %d %d %d %d %d"
```
éªŒè¯æˆåŠŸæ˜¯ï¼Œå…­ä¸ªæ•°å­—çš„è¾“å…¥æ ¼å¼æ§åˆ¶ç¬¦ã€‚
æˆ‘ä»¬å›åˆ°`phase_2`å‡½æ•°ï¼š
```bash
(gdb) disas phase_2
Dump of assembler code for function phase_2:
   0x0000000000400efc <+0>:	push   %rbp
   0x0000000000400efd <+1>:	push   %rbx
   0x0000000000400efe <+2>:	sub    $0x28,%rsp
   0x0000000000400f02 <+6>:	mov    %rsp,%rsi
   0x0000000000400f05 <+9>:	callq  0x40145c <read_six_numbers>
=> 0x0000000000400f0a <+14>:	cmpl   $0x1,(%rsp)
   0x0000000000400f0e <+18>:	je     0x400f30 <phase_2+52>
   0x0000000000400f10 <+20>:	callq  0x40143a <explode_bomb>
   0x0000000000400f15 <+25>:	jmp    0x400f30 <phase_2+52>
   0x0000000000400f17 <+27>:	mov    -0x4(%rbx),%eax
   0x0000000000400f1a <+30>:	add    %eax,%eax
   0x0000000000400f1c <+32>:	cmp    %eax,(%rbx)
   0x0000000000400f1e <+34>:	je     0x400f25 <phase_2+41>
   0x0000000000400f20 <+36>:	callq  0x40143a <explode_bomb>
   0x0000000000400f25 <+41>:	add    $0x4,%rbx
   0x0000000000400f29 <+45>:	cmp    %rbp,%rbx
   0x0000000000400f2c <+48>:	jne    0x400f17 <phase_2+27>
   0x0000000000400f2e <+50>:	jmp    0x400f3c <phase_2+64>
   0x0000000000400f30 <+52>:	lea    0x4(%rsp),%rbx
   0x0000000000400f35 <+57>:	lea    0x18(%rsp),%rbp
   0x0000000000400f3a <+62>:	jmp    0x400f17 <phase_2+27>
   0x0000000000400f3c <+64>:	add    $0x28,%rsp
   0x0000000000400f40 <+68>:	pop    %rbx
   0x0000000000400f41 <+69>:	pop    %rbp
   0x0000000000400f42 <+70>:	retq
End of assembler dump.
```

å‘ç°å°†`%rsp`èµ·å§‹åœ°å€æŒ‡å‘çš„å†…å®¹å’Œ0x1æ¯”è¾ƒã€‚ä¹Ÿå°±æ˜¯`buffer[0]`ï¼Œå¦‚æœç›¸ç­‰å°±è·³è½¬åˆ°`<phase_2+52>`å¦åˆ™å°±å¼•çˆ†ç‚¸å¼¹ï¼Œæ‰€ä»¥å¯ä»¥åˆ¤å®š`buffer[0] = 1`ï¼›

å°†`%rsp`åŠ ä¸Š0x4èµ‹ç»™`%rbx`ï¼Œä¹Ÿå°±æ˜¯å°†`&buffer[1]`çš„å€¼èµ‹ç»™äº†`rbx`å¯„å­˜å™¨ï¼›

å°†`%rsp`åŠ ä¸Š0x18èµ‹ç»™`%rbp`ï¼Œå°†`&buffer[6]`çš„å€¼èµ‹ç»™äº†`rbp`å¯„å­˜å™¨ä¹Ÿå°±æ˜¯æ•°ç»„çš„ä¸´ç•Œåœ°å€ï¼›

æ¥ç€è·³è½¬åˆ°`<phase_2+27>`ï¼Œå°†`%rbx`å‡0x4åçš„åœ°å€æŒ‡å‘çš„å†…å®¹èµ‹ç»™`%eax`ï¼Œä¹Ÿå°±æ˜¯`%eax = buffer[0]`ï¼Œå°†`%eax`æ‰©å¤§1å€ï¼Œç„¶åä¸`%rbx`åœ°å€æŒ‡å‘çš„å†…å®¹è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœä¸ç›¸ç­‰å¼•çˆ†ç‚¸å¼¹ï¼Œç›¸ç­‰æ¥ç€è·³è½¬ã€‚
...
å¯ä»¥å‘ç°å°±æ˜¯åœ¨æ¯”è¾ƒ
```c
buffer[5] = 2 * buffer[4];
buffer[4] = 2 * buffer[3];
...
buffer[1] = 2 * buffer[0];
buffer[0] = 1;
```
æ‰€ä»¥å­—ç¬¦ä¸²çš„å†…å®¹ä¾¿æ˜¯`1 2 4 8 16 32`ã€‚

ç¬¬äºŒä¸ªğŸ’£è§£é™¤ã€‚

## phase_3

```bash
(gdb) disas phase_3
Dump of assembler code for function phase_3:
   0x0000000000400f43 <+0>:	sub    $0x18,%rsp
   0x0000000000400f47 <+4>:	lea    0xc(%rsp),%rcx
   0x0000000000400f4c <+9>:	lea    0x8(%rsp),%rdx
   0x0000000000400f51 <+14>:	mov    $0x4025cf,%esi
   0x0000000000400f56 <+19>:	mov    $0x0,%eax
   0x0000000000400f5b <+24>:	callq  0x400bf0 <__isoc99_sscanf@plt>
   0x0000000000400f60 <+29>:	cmp    $0x1,%eax
   0x0000000000400f63 <+32>:	jg     0x400f6a <phase_3+39>
   0x0000000000400f65 <+34>:	callq  0x40143a <explode_bomb>
   0x0000000000400f6a <+39>:	cmpl   $0x7,0x8(%rsp)
   0x0000000000400f6f <+44>:	ja     0x400fad <phase_3+106>
   0x0000000000400f71 <+46>:	mov    0x8(%rsp),%eax
   0x0000000000400f75 <+50>:	jmpq   *0x402470(,%rax,8)
   0x0000000000400f7c <+57>:	mov    $0xcf,%eax
   0x0000000000400f81 <+62>:	jmp    0x400fbe <phase_3+123>
   0x0000000000400f83 <+64>:	mov    $0x2c3,%eax
   0x0000000000400f88 <+69>:	jmp    0x400fbe <phase_3+123>
   0x0000000000400f8a <+71>:	mov    $0x100,%eax
   0x0000000000400f8f <+76>:	jmp    0x400fbe <phase_3+123>
   0x0000000000400f91 <+78>:	mov    $0x185,%eax
   0x0000000000400f96 <+83>:	jmp    0x400fbe <phase_3+123>
   0x0000000000400f98 <+85>:	mov    $0xce,%eax
   0x0000000000400f9d <+90>:	jmp    0x400fbe <phase_3+123>
   0x0000000000400f9f <+92>:	mov    $0x2aa,%eax
   0x0000000000400fa4 <+97>:	jmp    0x400fbe <phase_3+123>
   0x0000000000400fa6 <+99>:	mov    $0x147,%eax
   0x0000000000400fab <+104>:	jmp    0x400fbe <phase_3+123>
   0x0000000000400fad <+106>:	callq  0x40143a <explode_bomb>
   0x0000000000400fb2 <+111>:	mov    $0x0,%eax
   0x0000000000400fb7 <+116>:	jmp    0x400fbe <phase_3+123>
   0x0000000000400fb9 <+118>:	mov    $0x137,%eax
   0x0000000000400fbe <+123>:	cmp    0xc(%rsp),%eax
   0x0000000000400fc2 <+127>:	je     0x400fc9 <phase_3+134>
   0x0000000000400fc4 <+129>:	callq  0x40143a <explode_bomb>
   0x0000000000400fc9 <+134>:	add    $0x18,%rsp
   0x0000000000400fcd <+138>:	retq
End of assembler dump.
```
æœ‰äº†ä¸Šä¸€ä¸ªphaseçš„ç»éªŒï¼Œæˆ‘ä»¬ä¹‹é—´æŸ¥çœ‹`%esi`çš„å†…å®¹ï¼š
```bash
(gdb) x/s $esi
0x4025cf:	"%d %d"
```
æˆ‘ä»¬å¯ä»¥æ¨æ–­è¾“å…¥çš„å­—ç¬¦ä¸²åŒ…å«2ä¸ªæ•´æ•°ã€‚ä¸€ä¸ªå­˜æ”¾åœ¨`%rsp+0x8`ï¼Œä¸€ä¸ªå­˜æ”¾åœ¨`%rsp+0xc`ä¸­ã€‚

`cmpl $0x7,0x8(%rsp)`ï¼Œæ¯”è¾ƒç¬¬ä¸€ä¸ªæ•°ä¸0x7çš„å¤§å°å…³ç³»ï¼Œå¦‚æœå¤§äº7è·³åˆ°<+106>å¼•çˆ†ç‚¸å¼¹ã€‚
ç”±äºæ˜¯`ja`å‘½ä»¤æ‰€ä»¥ï¼Œç¬¬ä¸€ä¸ªæ•°çš„èŒƒå›´æ˜¯`0-6`çš„æ•´æ•°ã€‚

å°†`mov 0x8(%rsp),%eax`å°†ç¬¬ä¸€ä¸ªæ•°èµ‹ç»™`%eax`ï¼Œ`jmpq   *0x402470(,%rax,8)`ï¼Œæ ¹æ®ç¬¬ä¸€ä¸ªæ•°çš„å€¼è¿›è¡Œä¸€æ¬¡é—´æ¥è·³è½¬ã€‚æˆ‘ä»¬åˆ†åˆ«æµ‹è¯•ç¬¬ä¸€ä¸ªæ•°`0-6`ï¼Œå¯ä»¥å¾—åˆ°ä¸åŒçš„é—´æ¥è·³è½¬ï¼Œå‘ç°æ¯ä¸ªè·³è½¬éƒ½æ˜¯ç¬¬äºŒä¸ªæ•°ä¸æŸä¸ªç«‹å³æ•°è¿›è¡Œæ¯”è¾ƒã€‚æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸‹è¡¨ã€‚

| ç¬¬ä¸€ä¸ªå‚æ•° | ç¬¬äºŒä¸ªå‚æ•° |
| --- | --- |
| 0 | 207 |
| 1 | 311 |
| 2 | 707 |
| 3 | 256 |
| 4 | 389 |
| 5 | 206 |
| 6 | 682 |

æ‰€ä»¥å­—ç¬¦ä¸²çš„å†…å®¹æ˜¯ä¸Šè¡¨ä¸­çš„ä»»æ„ä¸€å¯¹æ•°ï¼Œä¾‹å¦‚`0 207`ã€‚

ç¬¬ä¸‰ä¸ªğŸ’£è§£é™¤ã€‚


## phase_4

```bash
(gdb) disas phase_4
Dump of assembler code for function phase_4:
   0x000000000040100c <+0>:	sub    $0x18,%rsp
   0x0000000000401010 <+4>:	lea    0xc(%rsp),%rcx
   0x0000000000401015 <+9>:	lea    0x8(%rsp),%rdx
   0x000000000040101a <+14>:	mov    $0x4025cf,%esi
   0x000000000040101f <+19>:	mov    $0x0,%eax
   0x0000000000401024 <+24>:	callq  0x400bf0 <__isoc99_sscanf@plt>
   0x0000000000401029 <+29>:	cmp    $0x2,%eax
   0x000000000040102c <+32>:	jne    0x401035 <phase_4+41>
   0x000000000040102e <+34>:	cmpl   $0xe,0x8(%rsp)
   0x0000000000401033 <+39>:	jbe    0x40103a <phase_4+46>
   0x0000000000401035 <+41>:	callq  0x40143a <explode_bomb>
   0x000000000040103a <+46>:	mov    $0xe,%edx
   0x000000000040103f <+51>:	mov    $0x0,%esi
   0x0000000000401044 <+56>:	mov    0x8(%rsp),%edi
   0x0000000000401048 <+60>:	callq  0x400fce <func4>
   0x000000000040104d <+65>:	test   %eax,%eax
   0x000000000040104f <+67>:	jne    0x401058 <phase_4+76>
   0x0000000000401051 <+69>:	cmpl   $0x0,0xc(%rsp)
   0x0000000000401056 <+74>:	je     0x40105d <phase_4+81>
   0x0000000000401058 <+76>:	callq  0x40143a <explode_bomb>
   0x000000000040105d <+81>:	add    $0x18,%rsp
   0x0000000000401061 <+85>:	retq
End of assembler dump.
```
æŸ¥çœ‹`%esi`å¯„å­˜å™¨æŒ‡å‘çš„å†…å®¹ã€‚
```bash
(gdb) x/s $esi
0x4025cf:	"%d %d"
```
æˆ‘ä»¬èƒ½å¤Ÿå¾—çŸ¥å­—ç¬¦ä¸²åŒ…å«ä¸¤ä¸ªæ•´æ•°ã€‚ä½¿ç”¨`sscanf`å‡½æ•°è¯»å…¥ï¼Œè¿™éƒ¨åˆ†ä»£ç æˆ‘ä»¬ä¹‹å‰å·²ç»ç†Ÿæ‚‰è¿‡ä¸å†è®²è§£ã€‚
æˆ‘ä»¬ä»`<+46>`è¡Œå¼€å§‹çœ‹ï¼Œå°†`%edx`èµ‹å€¼ä¸º0xeï¼Œå°†`%esi`èµ‹å€¼ä¸º0x0ï¼Œå°†`%edi`èµ‹å€¼ä¸ºç¬¬ä¸€ä¸ªè¾“å…¥æ•´æ•°ï¼Œä¼ å…¥`func4`å‡½æ•°ä¸­ã€‚

æˆ‘ä»¬åæ±‡ç¼–æŸ¥çœ‹`func4`å‡½æ•°çš„ä»£ç ï¼š

```c
(gdb) disas func4
Dump of assembler code for function func4:
   0x0000000000400fce <+0>:	sub    $0x8,%rsp
   0x0000000000400fd2 <+4>:	mov    %edx,%eax 
   0x0000000000400fd4 <+6>:	sub    %esi,%eax
   0x0000000000400fd6 <+8>:	mov    %eax,%ecx
   0x0000000000400fd8 <+10>:	shr    $0x1f,%ecx
   0x0000000000400fdb <+13>:	add    %ecx,%eax
   0x0000000000400fdd <+15>:	sar    %eax
   0x0000000000400fdf <+17>:	lea    (%rax,%rsi,1),%ecx
   0x0000000000400fe2 <+20>:	cmp    %edi,%ecx
   0x0000000000400fe4 <+22>:	jle    0x400ff2 <func4+36>
   0x0000000000400fe6 <+24>:	lea    -0x1(%rcx),%edx
   0x0000000000400fe9 <+27>:	callq  0x400fce <func4>
   0x0000000000400fee <+32>:	add    %eax,%eax
   0x0000000000400ff0 <+34>:	jmp    0x401007 <func4+57>
   0x0000000000400ff2 <+36>:	mov    $0x0,%eax
   0x0000000000400ff7 <+41>:	cmp    %edi,%ecx
   0x0000000000400ff9 <+43>:	jge    0x401007 <func4+57>
   0x0000000000400ffb <+45>:	lea    0x1(%rcx),%esi
   0x0000000000400ffe <+48>:	callq  0x400fce <func4>
   0x0000000000401003 <+53>:	lea    0x1(%rax,%rax,1),%eax
   0x0000000000401007 <+57>:	add    $0x8,%rsp
   0x000000000040100b <+61>:	retq
End of assembler dump.
```

ç”±äº`%ecx`çš„å€¼è¢«è¦†ç›–è€Œæœªå…ˆä½¿ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ¤å®š`func4`ä½¿ç”¨3ä¸ªå‚æ•°å¯„å­˜å™¨ï¼Œåˆ†åˆ«æ˜¯`%edi`ï¼Œ`esi`ï¼Œ`edx`å¯„å­˜å™¨ã€‚

```c
void func4(int x, int y, int z)
x in %rdi, y in %rsi, z in %rdx, k in %rax, t in %rcx

ç¬¬ä¸€æ¬¡è¿›å…¥æ—¶ y = 0x0, z = 0xe;

mov %edx,%eax  
sub %esi,%eax              k = z - y; k = 0xe;
mov %eax,%ecx  
shr $0x1f,%ecx             t = k >> 31; t = 0x0;
add %ecx,%eax  
sar %eax                   k = (k + t) >> 1; k = 0x7;
lea (%rax,%rsi,1),%ecx     t = (k + y);  t = 0x7;
cmp %edi, %ecx             
jle <func4+36>             x < 0x7æ—¶ï¼Œä¼šç»§ç»­æ‰§è¡Œï¼Œå¦åˆ™è·³è½¬<func4+36>
lea -0x1(%rcx),%edx        z = t - 1; z = 0x6;
callq <func4>              x < 0x7æ—¶ä¼šé€’å½’è°ƒç”¨<func4>

<func4+36>
mov $0x0,%eax              k = 0x0;
cmp %edi,%ecx              
jge <func4+57>             x 0x7 >= xæ—¶ï¼Œè·³è½¬<func4+57> ç”±äºä¹‹å‰çš„åˆ¤å®šx < 0x7 æ‰§è¡Œåˆ°è¿™é‡Œæ˜¯ x >=0x7 æ‰€ä»¥x == 0x7æ—¶è·³è½¬<func4+57>ï¼Œå‘ç°è·³è½¬<57>åå°±å°±è·³å‡ºå‡½æ•°äº† 
```

åé¢çš„ä¸€æ®µä»£ç å°±ä¸åˆ†æäº†ã€‚ä»å‰é¢çš„ä»£ç æˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼šè¦æƒ³å‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œ`%rdi`å¯„å­˜å™¨çš„å†…å®¹å¿…é¡»æ˜¯0x7ï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°çš„å€¼ã€‚

æ‰§è¡Œå®Œ`func4`å‡½æ•°åè¿”å›`phase_4`ï¼Œ`cmpl $0x0,0xc(%rsp)`ï¼Œæ£€æŸ¥ç¬¬äºŒä¸ªå‚æ•°ä¸0æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœä¸ç›¸ç­‰å°±ä¼šå¼•çˆ†ç‚¸å¼¹ï¼Œè¯´æ˜ç¬¬äºŒä¸ªå‚æ•°æ˜¯0x0ã€‚

æ‰€ä»¥å­—ç¬¦ä¸²çš„å†…å®¹æ˜¯`7 0`ã€‚

ç¬¬å››ä¸ªğŸ’£æ‹†é™¤ã€‚

## phase_5

```bash
(gdb) disas phase_5
Dump of assembler code for function phase_5:
   0x0000000000401062 <+0>:	push   %rbx
   0x0000000000401063 <+1>:	sub    $0x20,%rsp
   0x0000000000401067 <+5>:	mov    %rdi,%rbx
   0x000000000040106a <+8>:	mov    %fs:0x28,%rax
   0x0000000000401073 <+17>:	mov    %rax,0x18(%rsp)
   0x0000000000401078 <+22>:	xor    %eax,%eax
   0x000000000040107a <+24>:	callq  0x40131b <string_length>
   0x000000000040107f <+29>:	cmp    $0x6,%eax
   0x0000000000401082 <+32>:	je     0x4010d2 <phase_5+112>
   0x0000000000401084 <+34>:	callq  0x40143a <explode_bomb>
   0x0000000000401089 <+39>:	jmp    0x4010d2 <phase_5+112>
   0x000000000040108b <+41>:	movzbl (%rbx,%rax,1),%ecx
   0x000000000040108f <+45>:	mov    %cl,(%rsp)
   0x0000000000401092 <+48>:	mov    (%rsp),%rdx
   0x0000000000401096 <+52>:	and    $0xf,%edx
   0x0000000000401099 <+55>:	movzbl 0x4024b0(%rdx),%edx
   0x00000000004010a0 <+62>:	mov    %dl,0x10(%rsp,%rax,1)
   0x00000000004010a4 <+66>:	add    $0x1,%rax
   0x00000000004010a8 <+70>:	cmp    $0x6,%rax
   0x00000000004010ac <+74>:	jne    0x40108b <phase_5+41>
   0x00000000004010ae <+76>:	movb   $0x0,0x16(%rsp)
   0x00000000004010b3 <+81>:	mov    $0x40245e,%esi
   0x00000000004010b8 <+86>:	lea    0x10(%rsp),%rdi
   0x00000000004010bd <+91>:	callq  0x401338 <strings_not_equal>
   0x00000000004010c2 <+96>:	test   %eax,%eax
   0x00000000004010c4 <+98>:	je     0x4010d9 <phase_5+119>
   0x00000000004010c6 <+100>:	callq  0x40143a <explode_bomb>
   0x00000000004010cb <+105>:	nopl   0x0(%rax,%rax,1)
   0x00000000004010d0 <+110>:	jmp    0x4010d9 <phase_5+119>
   0x00000000004010d2 <+112>:	mov    $0x0,%eax
   0x00000000004010d7 <+117>:	jmp    0x40108b <phase_5+41>
   0x00000000004010d9 <+119>:	mov    0x18(%rsp),%rax
   0x00000000004010de <+124>:	xor    %fs:0x28,%rax
   0x00000000004010e7 <+133>:	je     0x4010ee <phase_5+140>
   0x00000000004010e9 <+135>:	callq  0x400b30 <__stack_chk_fail@plt>
   0x00000000004010ee <+140>:	add    $0x20,%rsp
   0x00000000004010f2 <+144>:	pop    %rbx
   0x00000000004010f3 <+145>:	retq
End of assembler dump.
```
å…ˆæ£€æŸ¥å­—ç¬¦ä¸²é•¿åº¦æ˜¯å¦ä¸º6ï¼Œå¦‚æœé•¿åº¦ä¸ä¸º6ç›´æ¥å¼•çˆ†ç‚¸å¼¹ã€‚å–å‡ºå­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸0xfç›¸ä¸ï¼Œå–å‡ºå­—ç¬¦çš„ç¬¬å››ä½ä½œä¸ºåç§»é‡ã€‚å–å‡º`0x4024b0+åç§»é‡`åœ°å€æŒ‡å‘çš„å­—èŠ‚å†…å®¹èµ‹ç»™æ ˆç©ºé—´ã€‚å¾ªç¯ä»ç¬¬ä¸€ä¸ªå­—ç¬¦åˆ°ç¬¬6ä¸ªå­—ç¬¦ï¼Œæœ€åå°†å­—ç¬¦ä¸²ä¸`0x40245e`åœ°å€æŒ‡å‘çš„å­—ç¬¦ä¸²æ¯”è¾ƒï¼Œå¦‚æœç›¸ç­‰æˆåŠŸè§£é™¤ç‚¸å¼¹å¦åˆ™å¼•çˆ†ã€‚

æˆ‘ä»¬æŸ¥çœ‹ä¸¤ä¸ªåœ°å€æŒ‡å‘çš„å†…å®¹ã€‚
```bash
(gdb) x/s 0x4024b0
0x4024b0 <array.3449>:	"maduiersnfotvbylSo you think you can stop the bomb with ctrl-c, do you?"
(gdb) x/s 0x40245e
0x40245e:	"flyers"
```
æˆ‘ä»¬ä»é•¿å­—ç¬¦ä¸²é€‰å‡ºç»„æˆ`"flyers"`ï¼Œå¯ä»¥ä½¿ç”¨ç¨‹åºä»£ç å¸®åŠ©æˆ‘ä»¬å†™å‡ºåç§»å€¼ã€‚
```cpp
#include <iostream>
#include <string>
using namespace std;
int main() {
  string a = "maduiersnfotvbylSo you think you can stop the bomb with ctrl-c, do you?";
  string b = "flyers";
  for (int i = 0; i < b.size(); ++i) {
    for (int j = 0; j < a.size(); ++j) {
      if (b[i] == a[j]) {
        cout << j << endl;
        break;
      }
    }
  }
  return 0;
}

9 15 14 5 6 7
```
æˆ‘ä»¬å†æŠŠåç§»å€¼ä½œä¸ºASCIIå­—ç¬¦çš„ä½å››ä½ï¼Œæ„é€ æˆå¯è¾“å…¥çš„å­—ç¬¦ã€‚æˆ‘è¿™é‡Œæ˜¯åˆ†åˆ«åŠ ä¸Š80(01010000)ï¼Œæ„æˆç¬¬äº”ä¸ªå­—ç¬¦ä¸²`Y_^UVW`ã€‚

ç¬¬äº”ä¸ªğŸ’£æ‹†é™¤ã€‚

## phase_6

```bash
(gdb) disas phase_6
Dump of assembler code for function phase_6:
   0x00000000004010f4 <+0>:	push   %r14
   0x00000000004010f6 <+2>:	push   %r13
   0x00000000004010f8 <+4>:	push   %r12
   0x00000000004010fa <+6>:	push   %rbp
   0x00000000004010fb <+7>:	push   %rbx
   0x00000000004010fc <+8>:	sub    $0x50,%rsp
   0x0000000000401100 <+12>:	mov    %rsp,%r13
   0x0000000000401103 <+15>:	mov    %rsp,%rsi
   0x0000000000401106 <+18>:	callq  0x40145c <read_six_numbers>
   0x000000000040110b <+23>:	mov    %rsp,%r14
   0x000000000040110e <+26>:	mov    $0x0,%r12d
   0x0000000000401114 <+32>:	mov    %r13,%rbp
   0x0000000000401117 <+35>:	mov    0x0(%r13),%eax
   0x000000000040111b <+39>:	sub    $0x1,%eax
   0x000000000040111e <+42>:	cmp    $0x5,%eax
   0x0000000000401121 <+45>:	jbe    0x401128 <phase_6+52>
   0x0000000000401123 <+47>:	callq  0x40143a <explode_bomb>
   0x0000000000401128 <+52>:	add    $0x1,%r12d
   0x000000000040112c <+56>:	cmp    $0x6,%r12d
   0x0000000000401130 <+60>:	je     0x401153 <phase_6+95>
   0x0000000000401132 <+62>:	mov    %r12d,%ebx
   0x0000000000401135 <+65>:	movslq %ebx,%rax
   0x0000000000401138 <+68>:	mov    (%rsp,%rax,4),%eax
   0x000000000040113b <+71>:	cmp    %eax,0x0(%rbp)
   0x000000000040113e <+74>:	jne    0x401145 <phase_6+81>
   0x0000000000401140 <+76>:	callq  0x40143a <explode_bomb>
   0x0000000000401145 <+81>:	add    $0x1,%ebx
   0x0000000000401148 <+84>:	cmp    $0x5,%ebx
   0x000000000040114b <+87>:	jle    0x401135 <phase_6+65>
   0x000000000040114d <+89>:	add    $0x4,%r13
   0x0000000000401151 <+93>:	jmp    0x401114 <phase_6+32>
   0x0000000000401153 <+95>:	lea    0x18(%rsp),%rsi
   0x0000000000401158 <+100>:	mov    %r14,%rax
   0x000000000040115b <+103>:	mov    $0x7,%ecx
   0x0000000000401160 <+108>:	mov    %ecx,%edx
   0x0000000000401162 <+110>:	sub    (%rax),%edx
   0x0000000000401164 <+112>:	mov    %edx,(%rax)
   0x0000000000401166 <+114>:	add    $0x4,%rax
   0x000000000040116a <+118>:	cmp    %rsi,%rax
   0x000000000040116d <+121>:	jne    0x401160 <phase_6+108>
   0x000000000040116f <+123>:	mov    $0x0,%esi
   0x0000000000401174 <+128>:	jmp    0x401197 <phase_6+163>
   0x0000000000401176 <+130>:	mov    0x8(%rdx),%rdx
   0x000000000040117a <+134>:	add    $0x1,%eax
   0x000000000040117d <+137>:	cmp    %ecx,%eax
   0x000000000040117f <+139>:	jne    0x401176 <phase_6+130>
   0x0000000000401181 <+141>:	jmp    0x401188 <phase_6+148>
   0x0000000000401183 <+143>:	mov    $0x6032d0,%edx
   0x0000000000401188 <+148>:	mov    %rdx,0x20(%rsp,%rsi,2)
   0x000000000040118d <+153>:	add    $0x4,%rsi
   0x0000000000401191 <+157>:	cmp    $0x18,%rsi
   0x0000000000401195 <+161>:	je     0x4011ab <phase_6+183>
   0x0000000000401197 <+163>:	mov    (%rsp,%rsi,1),%ecx
   0x000000000040119a <+166>:	cmp    $0x1,%ecx
   0x000000000040119d <+169>:	jle    0x401183 <phase_6+143>
   0x000000000040119f <+171>:	mov    $0x1,%eax
   0x00000000004011a4 <+176>:	mov    $0x6032d0,%edx
   0x00000000004011a9 <+181>:	jmp    0x401176 <phase_6+130>
   0x00000000004011ab <+183>:	mov    0x20(%rsp),%rbx
   0x00000000004011b0 <+188>:	lea    0x28(%rsp),%rax
   0x00000000004011b5 <+193>:	lea    0x50(%rsp),%rsi
   0x00000000004011ba <+198>:	mov    %rbx,%rcx
   0x00000000004011bd <+201>:	mov    (%rax),%rdx
   0x00000000004011c0 <+204>:	mov    %rdx,0x8(%rcx)
   0x00000000004011c4 <+208>:	add    $0x8,%rax
   0x00000000004011c8 <+212>:	cmp    %rsi,%rax
   0x00000000004011cb <+215>:	je     0x4011d2 <phase_6+222>
   0x00000000004011cd <+217>:	mov    %rdx,%rcx
   0x00000000004011d0 <+220>:	jmp    0x4011bd <phase_6+201>
   0x00000000004011d2 <+222>:	movq   $0x0,0x8(%rdx)
   0x00000000004011da <+230>:	mov    $0x5,%ebp
   0x00000000004011df <+235>:	mov    0x8(%rbx),%rax
   0x00000000004011e3 <+239>:	mov    (%rax),%eax
   0x00000000004011e5 <+241>:	cmp    %eax,(%rbx)
   0x00000000004011e7 <+243>:	jge    0x4011ee <phase_6+250>
   0x00000000004011e9 <+245>:	callq  0x40143a <explode_bomb>
   0x00000000004011ee <+250>:	mov    0x8(%rbx),%rbx
   0x00000000004011f2 <+254>:	sub    $0x1,%ebp
   0x00000000004011f5 <+257>:	jne    0x4011df <phase_6+235>
   0x00000000004011f7 <+259>:	add    $0x50,%rsp
   0x00000000004011fb <+263>:	pop    %rbx
   0x00000000004011fc <+264>:	pop    %rbp
   0x00000000004011fd <+265>:	pop    %r12
   0x00000000004011ff <+267>:	pop    %r13
   0x0000000000401201 <+269>:	pop    %r14
   0x0000000000401203 <+271>:	retq
End of assembler dump.
```

ç¬¬6ä¸ª`phase_6`å‡½æ•°æ¯”è¾ƒé•¿ä½†é€»è¾‘å¹¶ä¸å¤æ‚ã€‚æŒ‡ä»¤æ‰§è¡Œçš„é€»è¾‘æ˜¯ï¼š

1. è¾“å…¥åŒ…å«6ä¸ªæ•´æ•°çš„å­—ç¬¦ä¸²ã€‚
2. ä½¿ç”¨åµŒå¥—çš„å¾ªç¯ï¼ŒéªŒè¯æ¯ä¸ªæ•°éƒ½å°äºç­‰äº6ï¼Œå¤§äºç­‰äº0ï¼Œä¸”æ¯ä¸ªæ•°äº’ä¸ç›¸ç­‰ã€‚
3. å¯¹æ¯ä¸ªæ•´æ•°è¿›è¡Œä¸€æ¬¡å¤„ç†`x = 7 - x`ã€‚
3. ä½¿ç”¨é¢å¤–çš„æ ˆç©ºé—´ï¼Œå­˜å‚¨æ¯ä¸ªæ•°iæŒ‡å‘ä¸€ä¸ªé“¾è¡¨çš„ç»“ç‚¹åœ°å€ã€‚
4. æ›´æ”¹é“¾è¡¨çš„æŒ‡å‘ã€‚
5. é“¾è¡¨æŒ‰ç…§å€¼é€’å‡çš„é¡ºåºã€‚

```bash
   # è®¾æ¯ä¸ªæ•°çš„å€¼æ˜¯iï¼Œé“¾è¡¨æ˜¯nodeã€‚æŒ‡ä»¤çš„æ“ä½œæ˜¯å°†æ¯ä¸ªæ•°æ˜ å°„æ ˆç©ºé—´çš„å†…å­˜å•å…ƒå­˜æ”¾çš„æ˜¯é“¾è¡¨ç¬¬iä¸ªç»“ç‚¹çš„åœ°å€ã€‚å¦‚æœç¬¬1ä¸ªæ•´æ•°çš„å€¼æ˜¯6ï¼Œå¯¹åº”å†…å­˜å•å…ƒå­˜æ”¾çš„æ˜¯é“¾è¡¨ç¬¬6ä¸ªç»“ç‚¹çš„åœ°å€ã€‚
   0x000000000040116f <+123>:	mov    $0x0,%esi
   0x0000000000401174 <+128>:	jmp    0x401197 <phase_6+163>
   0x0000000000401176 <+130>:	mov    0x8(%rdx),%rdx # cur = cur -> next ä¸‹ä¸€ä¸ªåœ°å€ã€‚
   0x000000000040117a <+134>:	add    $0x1,%eax 
   0x000000000040117d <+137>:	cmp    %ecx,%eax # æ¯”è¾ƒ
   0x000000000040117f <+139>:	jne    0x401176 <phase_6+130>
   0x0000000000401181 <+141>:	jmp    0x401188 <phase_6+148>
   0x0000000000401183 <+143>:	mov    $0x6032d0,%edx # å°†é“¾è¡¨é¦–åœ°å€èµ‹ç»™å…ƒç´ å¯¹åº”çš„æ ˆç©ºé—´ã€‚
   0x0000000000401188 <+148>:	mov    %rdx,0x20(%rsp,%rsi,2)
   0x000000000040118d <+153>:	add    $0x4,%rsi
   0x0000000000401191 <+157>:	cmp    $0x18,%rsi
   0x0000000000401195 <+161>:	je     0x4011ab <phase_6+183>
   0x0000000000401197 <+163>:	mov    (%rsp,%rsi,1),%ecx # å–å‡ºç¬¬esi+1ä¸ªæ•°ã€‚
   0x000000000040119a <+166>:	cmp    $0x1,%ecx 
   0x000000000040119d <+169>:	jle    0x401183 <phase_6+143> # ç”±äºæ¯ä¸ªæ•°å¤§äºç­‰äº1ï¼Œæ­¤å¤„æ£€æŸ¥æ˜¯ä¸æ˜¯1ï¼Œå¦‚æœæ˜¯1è·³è½¬<phase_6+143>ã€‚
   0x000000000040119f <+171>:	mov    $0x1,%eax # æ¯”è¾ƒflag
   0x00000000004011a4 <+176>:	mov    $0x6032d0,%edx
   0x00000000004011a9 <+181>:	jmp    0x401176 <phase_6+130>

(gdb) x 0x6032d0
0x6032d0 <node1>:	0x0000014c
(gdb) x/36 0x6032d0
0x6032d0 <node1>:	0x0000014c	0x00000001	0x006032e0	0x00000000
0x6032e0 <node2>:	0x000000a8	0x00000002	0x006032f0	0x00000000
0x6032f0 <node3>:	0x0000039c	0x00000003	0x00603300	0x00000000
0x603300 <node4>:	0x000002b3	0x00000004	0x00603310	0x00000000
0x603310 <node5>:	0x000001dd	0x00000005	0x00603320	0x00000000
0x603320 <node6>:	0x000001bb	0x00000006	0x00000000	0x00000000

(gdb) x/24d 0x6032d0
0x6032d0 <node1>:	332	1	6304480	0
0x6032e0 <node2>:	168	2	6304496	0
0x6032f0 <node3>:	924	3	6304512	0
0x603300 <node4>:	691	4	6304528	0
0x603310 <node5>:	477	5	6304544	0
0x603320 <node6>:	443	6	0	0
```
æŸ¥çœ‹`0x6032d0`åœ°å€æŒ‡å‘çš„ç©ºé—´ï¼Œå‘ç°æ˜¯ä¸€ä¸ªç»“æ„ä½“é“¾è¡¨ï¼Œæ¯ä¸ªç»“ç‚¹å­˜å‚¨ä¸€ä¸ªå€¼å’Œé“¾è¡¨ç»“ç‚¹åºå·å’ŒnextæŒ‡é’ˆã€‚

æ ¹æ®æ¯ä¸ªæ•´æ•°çš„å€¼å–å¾—ç›¸åº”çš„é“¾æ¥ç»“ç‚¹åœ°å€ï¼Œç„¶åä¿®æ”¹é“¾è¡¨ç»“ç‚¹çš„nextæŒ‡é’ˆï¼Œä½¿å¾—é“¾è¡¨æ„æˆå€¼é™åºã€‚æ‰€ä»¥ä¿®æ”¹åçš„é“¾è¡¨åº”è¯¥æ˜¯(924) -> (691) -> (477) -> (443) -> (332) -> (168)ï¼Œç›¸åº”çš„ç»“ç‚¹åºå·åºåˆ—åº”è¯¥æ˜¯(3) -> (4) -> (5) -> (6) -> (1) -> (2)ã€‚

ç”±äºå€¼æ˜¯è¢«7å¤„ç†è¿‡çš„ï¼ŒåŸæ•´æ•°åºåˆ—åº”è¯¥ä¸º`4 3 2 1 6 5 `ï¼Œç¬¬6ä¸ªå­—ç¬¦ä¸²åº”è¯¥æ˜¯`4 3 2 1 6 5`ã€‚

ç¬¬å…­ä¸ªğŸ’£æ‹†é™¤ã€‚

## æ€»ç»“
è·Ÿç€ç½‘å‹çš„ç­”æ¡ˆå‚è€ƒå­¦ä¹ å®Œè‘—åçš„**Bomb Lab**ï¼Œæ„Ÿè§‰æ”¶è·æ»¡æ»¡ã€‚å¯¹æ±‡ç¼–è¯­è¨€æœ‰äº†ä¸€å®šçš„äº†è§£ï¼Œå¯¹`%rsp`å’Œå…¶ä»–å‚æ•°å¯„å­˜å™¨æœ‰äº†æ›´æ·±åˆ»çš„è®¤è¯†ï¼Œå¯¹æŒ‡é’ˆå’Œåœ°å€çš„ä½¿ç”¨ä¹Ÿæ›´åŠ æ¸…æ™°ã€‚